openapi: 3.0.0
info:
  title: SWSE Architect API
  description: API for managing SWSE ships, libraries, hangars, and configurations.
  version: 2.0.0
servers:
  - url: http://localhost:8787
    description: Local Development Server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Resource:
      type: object
      properties:
        id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [ship, library, hangar, config]
        data:
          type: object
          description: Flexible JSON data depending on type
        visibility:
          type: string
          enum: [private, group, public]
        created_at:
          type: integer
          format: int64
        updated_at:
          type: integer
          format: int64
        _links:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/Link'

    Link:
      type: object
      properties:
        href:
          type: string
        rel:
          type: string
        method:
          type: string

    CreateResourceRequest:
      type: object
      required:
        - name
        - visibility
        - data
      properties:
        name:
          type: string
        visibility:
          type: string
          enum: [private, group, public]
        data:
          type: object

    ShareResourceRequest:
      type: object
      required:
        - grantee_id
        - grantee_type
        - access_level
      properties:
        grantee_id:
          type: string
        grantee_type:
          type: string
          enum: [user, group, app]
        access_level:
          type: string
          enum: [read, write, admin]

paths:
  /health:
    get:
      summary: Health Check
      responses:
        '200':
          description: OK

  /auth/register:
    post:
      summary: Register a new user
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [email, password, name]
              properties:
                email: {type: string}
                password: {type: string}
                name: {type: string}
      responses:
        '200':
          description: User registered

  /auth/login:
    post:
      summary: Login
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: {type: string}
                password: {type: string}
      responses:
        '200':
          description: Login successful

  /ships:
    get:
      summary: List Ships
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: List of ships
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Resource'
    post:
      summary: Create Ship
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '200':
          description: Ship created

  /ships/{resourceID}:
    get:
      summary: Get Ship
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      responses:
        '200':
          description: Ship details
    put:
      summary: Update Ship
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '200':
          description: Ship updated
    delete:
      summary: Delete Ship
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      responses:
        '204':
          description: Ship deleted

  /ships/{resourceID}/share:
    patch:
      summary: Share Ship
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShareResourceRequest'
      responses:
        '200':
          description: Shared successfully

  # Libraries
  /libraries:
    get:
      summary: List Libraries
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: List of libraries
    post:
      summary: Create Library
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '200':
          description: Library created

  /libraries/{resourceID}:
    get:
      summary: Get Library
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      responses:
        '200':
          description: Library details
    put:
      summary: Update Library
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '200':
          description: Library updated
    delete:
      summary: Delete Library
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      responses:
        '204':
          description: Library deleted

  /libraries/{resourceID}/share:
    patch:
      summary: Share Library
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShareResourceRequest'
      responses:
        '200':
          description: Shared successfully

  # Hangars
  /hangars:
    get:
      summary: List Hangars
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: List of hangars
    post:
      summary: Create Hangar
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '200':
          description: Hangar created

  /hangars/{resourceID}:
    get:
      summary: Get Hangar
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      responses:
        '200':
          description: Hangar details
    put:
      summary: Update Hangar
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '200':
          description: Hangar updated
    delete:
      summary: Delete Hangar
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      responses:
        '204':
          description: Hangar deleted

  /hangars/{resourceID}/share:
    patch:
      summary: Share Hangar
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShareResourceRequest'
      responses:
        '200':
          description: Shared successfully

  # Configurations
  /configurations:
    get:
      summary: List Configurations
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: List of configurations
    post:
      summary: Create Configuration
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '200':
          description: Configuration created

  /configurations/{resourceID}:
    get:
      summary: Get Configuration
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      responses:
        '200':
          description: Configuration details
    put:
      summary: Update Configuration
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateResourceRequest'
      responses:
        '200':
          description: Configuration updated
    delete:
      summary: Delete Configuration
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      responses:
        '204':
          description: Configuration deleted

  /configurations/{resourceID}/share:
    patch:
      summary: Share Configuration
      security: [{bearerAuth: []}]
      parameters:
        - in: path
          name: resourceID
          schema: {type: string}
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ShareResourceRequest'
      responses:
        '200':
          description: Shared successfully
